# Node Updates

- 2024-10-20 - v18.11.0 -> v18.12.0

# Firebase Updates

- 2024-12-13 - v13.28.0 -> v13.29.0
- 2024-12-06 - v13.27.0 -> v13.28.0
- 2024-11-27 - v13.25.0 -> v13.27.0
- 2024-11-18 - v13.20.2 -> v13.25.0

# Firebase Functions Updates

- 2024-10-24 - ^v5.1.1 -> ^v6.1.0

# System Updates

## 備忘録

- 配置管理での Placement クラスインスタンスの subscribe だが、リソースを節約するために配置データの存在するセルのみ実行しようとするとうまくいかない。制御が複雑になるため、特段の理由がない限りは現行のままでいくこと。

## 課題・要望一覧

1. 従業員の社会保険の加入状況について管理
2. 配置表を開いている人が知りたい。（かなり面倒）
3. マスタデータを削除した後、一覧画面に遷移した際に削除したデータが一覧に表示されてしまう。 -> Vuex が参照している Realtime Database からの削除処理を Cloud Functions が担っているためのタイムラグ。
4. GInputSubmitMixin で、エラー発生時のアラート表示を止めたい。エラーメッセージ用プロパティを用意して、VAlert を使うようにするか？
5. ミルックスの請求書出力を作りたい？？？
6. 会社の予定を追加できるようにしても良いかもしれない。（祝日管理機能に実装？？？）

## 実装計画

- 同期したマスタデータの同期解除処理
- 誤って作成してしまった現場マスタの統合処理
- AArrayManager のようなレンダーレスコンポーネントでドキュメントを管理したい。（MIXINS は見通しが悪くてメンテナンスがしづらい）
  - ADocumentManager として実装可能だが、影響範囲が大きいため後回し。
- Cloud Functions の syncDependentDocumentsV2 をテスト（非正規化ドキュメントの同期処理について配列にも対応したバージョン）

## xxxx-xx-xx - ver 0.0.0

### 修正: 雇用契約書 PDF

- 角印の出力を追加

## 2024-12-16 - ver 0.8.6

### 修正: トップ画面

- 雇用契約満了アラートで従業員のリストをクリックしたら従業員の詳細画面に遷移するように設定

### 修正: 配置管理

- 配置管理上での現場の稼働予定が削除できないバグを修正

### 修正: 稼働予定管理

- 不要な現場の非表示化、表示すべき現場が非表示になっているときのアラート表示、表示すべき現場の再表示化機能を実装

### その他

- 再利用可能なコンポーネントとして GCardColorIndicator を実装。リファクタリング。
- 現場稼働予定モデルの開始時刻、終了時刻の必須入力を解除（休工時に値が入らなくなるため）
- pdf 生成モジュールをリファクタリング。（ラッパーのインジェクトを廃止し、新しいラッパーを js モジュールとして新規実装）
- 月次請求管理機能をリファクタリング。

## 2024-12-13 - ver 0.8.5

### 修正: 現場管理

- 配置管理で使用されている現場を削除しようとした場合にエラーになるように修正

### 追加: 現場稼働予定管理

- 一定期間（90 日）を超過した稼働予定が日次処理で削除されるように機能を追加

### 追加: 従業員雇用契約管理

- 労働条件通知書の PDF 印刷を追加

### 追加: 従業員管理

- 警備員登録情報を充足
- 伴って、CSV インポート、API インポートにも対象プロパティを追加

### その他

- アプリ設定から別の画面に遷移した際、エラーになってしまうバグを修正

## 2024-12-13 - ver 0.8.4

- 現場マスタ、従業員マスタの削除ができないバグを修正
- Firestore に不足していたインデックスを追加

## 2024-12-12 - ver 0.8.3

### 機能追加: 現場管理

- 現場の稼働実績を一覧表示する機能を追加

## 2024-12-12 - ver 0.8.2

- ナビゲーションリストを JSON から JS に変更（メニュー機能を充実させる目的）
- ナビゲーションが画面サイズに応じて開いたままになるように修正
- ナビゲーションのレイアウトを調整（特にサブリスト）
- Vuex.air-guard.js を実装。未実装のマスタデータの存在チェックに使用する。
- 未同期の AirGuard マスタデータ（取引先、現場、従業員）があった場合に、ナビゲーションにアラートを表示する機能を追加
- その他若干のリファクタリング

## 2024-12-12 - ver 0.8.1

### 追加: Access 版 AirGuard とのマスタ同期

- API リクエストによりマスタデータを同期させる仕組みに現場と従業員を追加

## 2024-12-11 - ver 0.8.0

### 追加: Access 版 AirGuard とのマスタ同期

- API リクエストによりマスタデータを同期させる仕組みを追加（取引先のみ）

## 2024-12-10 - ver 0.7.7

### 修正: 就業規則管理

- 祝日登録で祝日設定から引用した一括登録ができる機能を実装

### その他

- GCalendar コンポーネントをリファクト
- 依存するコンポーネントをリファクト

## 2024-12-10 - ver 0.7.6

### 追加: 自社情報管理

- 新規実装

### 修正: 就業規則

- 労働条件通知に必要な項目を追加

### 機能追加: 稼働実績管理

- 取引先, 現場での絞り込み機能を実装
- 一覧表示をリファクタリング
- 検索項目の一括クリア機能実装

### その他

- データ編集等コンポーネント周りのファクタリング
- 就業規則の翌年度分一括作成時に複製元のドキュメント ID を保持するように修正
- GTemplateIndex にクリアボタンを実装

## 2024-12-04 - ver 0.7.5

### 追加: 手当マスタ管理機能

- 新規実装

### 修正: 従業員雇用契約管理

- 就業規則が変更できないバグを修正
- 手当管理機能を追加

### その他

- 軽微なリファクタリング

## 2024-12-02 - ver 0.7.4

### 修正: 就業規則管理

- 既存の就業規則を複製して翌年度の就業規則を作成する機能を追加
- 就業規則の一覧に`月平均所定労働日数`を追加

### 修正: 従業員雇用契約管理

- 追加, 修正時に選択されている就業規則の詳細を表示できる機能を追加

### 修正パッチ

- 従業員雇用契約ドキュメントの site プロパティを削除

## 2024-11-29 - ver 0.7.3

### 追加: 祝日管理

- 新規実装
- 会社の予定を追加できるようにしても良いかもしれない。

### 修正: 従業員雇用契約管理

- 就業規則の保存方法と雇用形態に関するバグを修正
- 社会保険加入に関する情報を追加

### 修正: 就業規則管理

- データモデルに就業規則 ID を追加

### その他

- アプリ側のモデルを一部リファクタリング

## 2024-11-28 - ver 0.7.2

### 修正: 月次請求管理

- 請求金額の集計処理が、指定した月を含む過去 3 ヶ月になってしまっていたのを修正

### リファクタリング: Cloud Functions

- AirGuard との同期およびインデックスデータの作成処理をリファクタリング
- 各種データモデル（クラス）と関数のリファクタリング

### その他

- 軽微な修正・バグフィックス

## 2024-11-27 - ver 0.7.1

### 修正: 月次売上（現時点非公開）

- リファクタリング: 自社情報を集計対象外にした

### 修正: 月次請求（現時点非公開）

- リファクタリング: 自社情報を集計対象外にした

### 修正: 従業員インポート

- 警備員登録情報のインポート処理を追加
- Access 版 AirGuard からのデータ取り込み処理をリファクタリング

### 修正: 従業員管理（現時点非公開）

- 警備員登録情報を追加
- 従業員インデックスに hasSecurityRegistration を追加

### 修正: 配置管理

- 従業員選択時に警備員登録有無でのフィルタリング機能を追加

### 追加: 従業員雇用契約満了アラート

- トップページに雇用契約がまもなく（14 日以内）に満了する従業員がいることをアラートできる機能を追加

### その他

- 軽微な修正
- 従業員選択コンポーネントの機能の見直し

### 反映手続き

1. 全従業員マスタデータの再取り込み
2. 従業員インデックスの再構築
3. パッチの適用

## 2024-11-26 - ver 0.7.0

### 修正: 従業員管理

- アクセス時に従業員情報の読み込みに失敗していたバグを修正
- 削除処理ができなかったのを修正（チェックボックス実装漏れ）
- インデックスの同期処理をリファクタリング
- 従業員雇用契約との同期処理をリファクタリング

### 追加: 従業員休暇申請管理

- 従業員の休暇申請情報を管理するための機能を実装（manager 権限限定で公開）

### 機能追加: 配置管理

- 休暇申請の存在する従業員に関してアラートできる機能を実装（manager 権限限定で公開）
- 当日の未上番現場のみに絞り込みができる機能を manager 権限限定で公開

### その他

- GTemplateIndex を改修。タイトルを付与し、ページネーションの表示を改善。伴って、当該コンポーネントを使用しているコンポーネントを修正。
- 検索用年月選択コンポーネント（GTextFieldSearchMonth）を実装。関連コンポーネントをリファクト。

## 2024-11-25 - ver 0.6.2

### その他

- Employee クラスと EmployeeContract クラスの循環参照を解消
- Site クラスと SiteOperationSchedule, SiteContract クラスの循環参照を解消
- EmployeeMinimal クラスを用意 -> EmployeeContract, EmployeeMedicalCheckup クラスに適用
- firestore.indexes.json から AttendanceRecords に関するインデックスを削除
- AttandanceRecords に関するコンポーネント, モデルを削除
- Cloud Functions からの無駄な非正規化データ同期処理を抑制するため、modules.utils.js に extractDiffsFromDocUpdatedEvent を実装。今後の改修で処理を組み込んでいく。

## 2024-11-25 - ver 0.6.1

### 修正: 取引先管理, 制服装備品管理, 外注先管理

- 編集時のデータを Vuex から取得してしまっていたのを修正

## 2024-11-23 - ver 0.6.0

### Vuex

- auth に `isDeveloper` を追加
  - 不具合発生時の早期対応に備えてコンポーネントに各種トラップを仕掛けておくため

### 修正: トップ画面

- デザインを刷新

### 修正: 月次売上管理

- 自社の稼働実績を集計から除外するように修正

### 修正: 稼働予定

- 休工フラグを追加 -> 休工にすると必要人数が強制的に 0 で登録されるように
- 配置管理で稼働予定が休工である場合はこれを表示し、スピードダイアルを表示に
- 稼働予定管理についても影響箇所を修正
- 現場-勤務区分のデータをリアルタイムリスナーで購読するにように修正

### 修正: Realtime Database

- SiteOperationSchedules ノードに対する write 権限が漏れていたのを修正

### 修正: 現場並べ替えコンポーネント

- 配置管理と稼働予定管理の現場並べ替えコンポーネントを共通化
- ダイアログ終了時にスクロール位置が初期化されない不具合を修正
- 現場名の下に取引先名を、現場名・取引先名の横に CODE を表示

### その他

軽微な修正

## 2024-11-22 - ver 0.5.6

- 外注先インデックスに `sync` プロパティが設定されていなかったのを修正
- 取引先、外注先の同期設定処理で、未同期のデータを取得する手法に誤りがあったのを修正
- メンテナンスのインデックス再構築に外注先を追加

## 2024-11-22 - ver 0.5.5

### 修正: GDataTable

- filterProps プロパティを追加し、headers に指定されていない項目についてもフィルタリングが可能になるように機能を追加
  - VDataTable の customFilter プロパティを使用するため、既に customFilter を使用していたコンポーネントを修正
  - 対象コンポーネントは GDataTableEmployees, GDialogEmployeeSelector

### 修正: GInputSite

- 既に実装していたあいまい検索結果の表示に略称を追加

## 2024-11-22 - ver 0.5.4

- 配置管理の勤務指示に出力される現場名を略称に変更

## 2024-11-22 - ver 0.5.3

### 取引先モデル

自社情報であるかどうかのフラグ `isInternal` を追加

### firestore.rules

- archive コレクションに対する権限を設定

## 2024-11-22 - ver 0.5.2

### 修正: 現場同期設定

同期元、同期先の一覧に取引先の略称を表示するように修正

### その他

- GDataTable の checkboxColor に既定値 `primary` を設定してリファクタリング
  - checkboxColor を設定しているコンポーネントを修正
- GDataTable に props.hideDefaultFooter を追加（規定値 true）

## 2024-11-22 - ver 0.5.1

### 修正: 従業員の現場入場履歴および現場の従業員入場履歴同期処理

従業員稼働実績ドキュメントが削除された際、従業員の現場入場履歴および現場の従業員入場履歴が正常に同期されなかったのを修正

## 2024-11-21 - ver 0.5.0

### 修正: 従業員データに略称カナを追加

- 従業員の絞り込み検索の際に略称カナを参照するように

### その他

- Realtime Database のルールを整理
- Firestore のルールを整理

## 2024-11-21 - ver 0.4.0

### 新機能: 稼働予定管理

当月から向こう 5 ヶ月先までの稼働予定をガントチャート風に管理できる機能を実装。
管理者権限（manager）にのみ公開。

### 追加: 配置管理での未上番限定表示

当日未上番である行のみを表示できる機能を実装（ただし、機能追加による混乱を避けるため、非公開）

### 修正: 配置管理/シフト管理

配置管理/シフト管理を以下のように修正

- 前日のシフトは操作不可
- 当日のシフトが登録されている、または既に配置されている場合は強制的にチェック
- 当日のシフトが登録されている場合は操作不可

### 修正: 現場削除時の従属データ同期削除

現場データを削除した時に、当該現場の稼働予定および取極めデータも同期的に削除されるように修正

### 修正: アップデートダイアログ

再起動するためのボタンを用意し、表示色を error から info に変更

### その他

- functions
  - ver 0.2.1 でコメントアウトした functions.models.Site の fetchByCode, fetchByCodes を削除
  - ver 0.2.1 でコメントアウトした functions.models.Employee の fetchByCode, fetchByCodes を削除
- components
  - PlacementEmployeeCardV2, PlacementOutsourcerCardV2 を削除
  - layouts.default に定義していた CSS を整理・改修
  - GPlacementTable で当日セルの背景色を黄色に変更
  - Vuex.systems の APP_VERSION を state に移動 -> コンポーネントからアプリのバージョンを確認可能に

## 2024-11-18 - ver 0.3.0

- データを削除するチェックボックスが画面を閉じても初期化されなかったバグを修正
  -> GInputSubmitMixin で保有していた data.forceDelete を GInputInitializeMixin に移設して初期化処理を追加した
- 取引先, 現場, 従業員マスタの詳細画面からデータを削除した場合に、一覧画面へ遷移しないバグを修正
- GDataTableSites の不要なコードを削除
- Realtime Database の取引先, 現場, 従業員のインデックスデータに sync プロパティを追加（要本番環境データ更新）
- ルーターミドルウェアをリファクタリング
  - メンテナンスモードでもアドミニストレーターはアプリを使用可能に（そうでないとテストできない）
  - メンテナンス中にログアウトした際、メンテナンス画面とログイン画面への無限ループが発生してしまうバグを修正
- 取引先, 現場, 従業員の DataTable をリファクタリング
  - Access 版 AirGuard との同期状態をチップコンポーネントで表示するように機能を追加
  - 画面サイズに応じた表示項目の切り替えを整理
- layouts.default.vue に .fixed-height-dialog (css) を追加。
  - dialog コンポーネントの content-class プロパティに適用すると、ダイアログの高さが固定される。
- 配置管理の現場選択コンポーネントを改善
  - 行をクリック（またはタップ）することで現場を選択できるように修正
  - 勤務区分選択をネストさせた別のダイアログで選択するように修正（勤務区分の選択を忘れて submit してしまうのを回避）
- 現場登録用コンポーネントで現場名を入力するとフォーカスが外れたタイミングで略称を自動セットするように改善
- 現場の新規登録時、入力された現場名に類似した既登録現場があった場合にアラートを表示する機能を実装
- 取引先の選択コンポーネント（GAutocompleteCustomer）に表示されるリストが略称カナの昇順になるように修正
- 配置管理でモバイルの場合に勤務指示のテキストをダイアログで表示する機能を追加
- その他細かなリファクタリングを実行

## 2024-11-16 - ver 0.2.1

- models.Site, functions.models.Site で稼働実績の従属設定が `subcollection` になっていたのを修正
- models.Site, functions.models.Site に現場取極めの従属設定がなされていなかったの修正
- functions.models.Site の fetchByCode, fetchByCodes メソッドをコメントアウト -> 未使用
- functions.models.Employee の fetchByCode, fetchByCodes メソッドをコメントアウト -> 未使用

## 2024-11-16 - ver 0.2.0

- 稼働実績の編集画面が tile 表示されるように修正
- GDialogInput がモバイルの時にフルスクリーン表示されるように修正
- GDialogInput が default スロットに tile を追加 / スロットに配置される GInput コンポーネントがモバイルの時に tile 表示になるように
- GCardinputForm の VCardTitle を VToolbar に変更し、レイアウトを調整
- GCheckboxDeleteData の hideDetails の既定値を true に設定
- pages から不要なファイルを削除
- atoms.renderless.ARenderlessCrud.vue を削除
- Vuex.systems をリファクタリング
- Placement クラスが date, siteId, workShift を受け取った途端に subscribe してしまうのを回避
- Placement クラスの date, siteId, workShift プロパティが必須になってしまっていたのを修正
- 日次バッチメンテナンスに（Cloud Functions）配置データの削除処理を追加。暫定で保存日数を 1 週間に設定。
- アプリメンテナンスに配置データの削除処理を実装。

## 2024-11-15 - ver 0.1.0

- 配置管理機能のレイアウトを調整
- 配置管理機能に現場-勤務区分へのジャンプ機能を実装
- 配置管理に関わるコンポーネントのコードをリファクタリング
- 従業員のインデックスに肩書、雇用形態を追加
- GComboboxDate でアイコンクリックでカレンダーが起動するように修正
- 権限管理に `管理者` を追加（既存の `管理者` を `アドミニストレータ` に変更）
- ユーザー管理で `管理者` 権限を制御できるように機能を追加
- 現場管理を管理者権限に公開
- 勤務指示テキストに従業員の肩書を出力するように修正

## 2024-11-14 - ver 0.0.1

- 勤務指示用テキストに肩書を適用するため、従業員管理に肩書を追加
